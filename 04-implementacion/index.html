
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../02-requisitos/">
      
      
        <link rel="next" href="../05-resultado/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Implementación (GIT) - File Monitoring System</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-implementacion-git" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="File Monitoring System" class="md-header__button md-logo" aria-label="File Monitoring System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            File Monitoring System
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Implementación (GIT)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="File Monitoring System" class="md-nav__button md-logo" aria-label="File Monitoring System" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    File Monitoring System
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduccion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducción
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-requisitos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Especificación de Requisitos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Diseño (Diagramas)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Diseño (Diagramas)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-diseno.md#casos-de-uso" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Casos de uso
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-diseno.md#diagrama-entidad-relación" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diagrama entidad-relación
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-diseno.md#esquema-para-bd-no-relacional" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Esquema NoSQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-diseno.md#diagrama-de-clases-del-modelo" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diagrama de clases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-diseno.md#diagramas-de-secuencia" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Diagramas de secuencia
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Implementación (GIT)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Implementación (GIT)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#4-implementacion-git" class="md-nav__link">
    <span class="md-ellipsis">
      4. Implementación (GIT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Implementación (GIT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-diagrama-de-arquitectura" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Diagrama de arquitectura
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-tecnologias" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Tecnologías
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Tecnologías">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-motor-de-validaciones-scala-spark" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 Motor de validaciones (Scala + Spark)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-backend-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 Backend (FastAPI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-frontend-react" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 Frontend (React)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-base-de-datos-y-otros" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 Base de datos y otros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-codigo-explicacion-de-las-partes-mas-interesantes" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 Código (Explicación de las partes más interesantes)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 Código (Explicación de las partes más interesantes)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-motor-de-validaciones-scala" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 Motor de validaciones (Scala)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432-backend-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.2 Backend (FastAPI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#433-frontend-react-vite" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.3 Frontend (React + Vite)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-organizacion-del-proyecto-patron" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 Organización del proyecto. Patrón
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-resultado/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resultado (Manual de usuario)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-conclusiones/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conclusiones
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#4-implementacion-git" class="md-nav__link">
    <span class="md-ellipsis">
      4. Implementación (GIT)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Implementación (GIT)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-diagrama-de-arquitectura" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Diagrama de arquitectura
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-tecnologias" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Tecnologías
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Tecnologías">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#421-motor-de-validaciones-scala-spark" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.1 Motor de validaciones (Scala + Spark)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#422-backend-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.2 Backend (FastAPI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#423-frontend-react" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.3 Frontend (React)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#424-base-de-datos-y-otros" class="md-nav__link">
    <span class="md-ellipsis">
      4.2.4 Base de datos y otros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-codigo-explicacion-de-las-partes-mas-interesantes" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 Código (Explicación de las partes más interesantes)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 Código (Explicación de las partes más interesantes)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#431-motor-de-validaciones-scala" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.1 Motor de validaciones (Scala)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#432-backend-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.2 Backend (FastAPI)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#433-frontend-react-vite" class="md-nav__link">
    <span class="md-ellipsis">
      4.3.3 Frontend (React + Vite)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-organizacion-del-proyecto-patron" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 Organización del proyecto. Patrón
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Implementación (GIT)</h1>

<h2 id="4-implementacion-git">4. Implementación (GIT)<a class="headerlink" href="#4-implementacion-git" title="Permanent link">&para;</a></h2>
<h3 id="41-diagrama-de-arquitectura">4.1 Diagrama de arquitectura<a class="headerlink" href="#41-diagrama-de-arquitectura" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">---
config:
  layout: dagre
---
flowchart LR
  subgraph Usuario[&quot;Usuario&quot;]
        Browser[&quot;User Browser&quot;]
  end
  subgraph Frontend[&quot;Frontend&quot;]
        React[&quot;React SPA&lt;br&gt;(Web App)&quot;]
  end
  subgraph API[&quot;API&quot;]
        FastAPI[&quot;FastAPI Backend&lt;br&gt;(Python)&quot;]
  end
  subgraph Persistencia[&quot;Persistencia&quot;]
        Postgres[&quot;PostgreSQL DB&quot;]
        HDFS[&quot;HDFS Cluster&quot;]
  end
  subgraph Procesamiento[&quot;Procesamiento&quot;]
        SparkMaster[&quot;🔷 Spark Master&quot;]
        SparkWorker1[&quot;🔶 Spark Worker 1&quot;]
        SparkWorker2[&quot;🔶 Spark Worker 2&quot;]
        ValidationEngine[&quot;Validation Engine&lt;br&gt;(Scala + Spark)&quot;]
  end
  subgraph subGraph7[&quot;Contenedores Docker&quot;]
        Superset[&quot;Superset BI&quot;]
  end

  Browser -- HTTP requests --&gt; React
  React -- REST/GraphQL&lt;br&gt;JSON over HTTP --&gt; FastAPI
  FastAPI -- SQLAlchemy (INSERT/SELECT/UPDATE) --&gt; Postgres
  FastAPI -- WebHDFS / HDFS Client --&gt; HDFS
  FastAPI -- SELECT * FROM TABLE --&gt; Postgres
  ValidationEngine -- Leer CSV/Parquet --&gt; HDFS
  ValidationEngine -- INSERT logs en trigger_control --&gt; Postgres
  ValidationEngine -- Spark job submission --&gt; SparkMaster
  SparkMaster --&gt; SparkWorker1 &amp; SparkWorker2
  SparkMaster -- HDFS FS Default --- HDFS
  SparkWorker1 -- HDFS FS Default --- HDFS
  SparkWorker2 -- HDFS FS Default --- HDFS
  Superset -- SQLAlchemy --&gt; Postgres

  style Usuario fill:#f9f,stroke:#333,stroke-width:1px
  style Frontend fill:#ccf,stroke:#333,stroke-width:1px
  style API fill:#cfc,stroke:#333,stroke-width:1px
  style Persistencia fill:#ffe599,stroke:#333,stroke-width:1px
  style Procesamiento fill:#f4cccc,stroke:#333,stroke-width:1px
</code></pre>
<ul>
<li>
<p><strong>Frontend (React + Vite)</strong></p>
<ul>
<li>Usuario interactúa con la UI, llama rutas REST al backend y muestra datos.</li>
<li>
<p><strong>Backend (FastAPI)</strong></p>
</li>
<li>
<p>Exposición de endpoints <code>/auth</code>, <code>/files</code>, <code>/files/logs</code>.</p>
</li>
<li>Usa <strong>SQLAlchemy Async + AsyncPG</strong> para comunicarse con PostgreSQL.</li>
<li>Utiliza <strong>requests</strong> para llamar a WebHDFS (NameNode/DataNode).</li>
<li>
<p><strong>PostgreSQL</strong></p>
</li>
<li>
<p>Almacena <code>users</code>, <code>file_configuration</code>, <code>trigger_control</code>, <code>negative_flag_logs</code>.</p>
</li>
<li>Superset (opcional) también se conecta aquí para dashboards.</li>
<li>
<p><strong>Motor Scala + Spark</strong></p>
</li>
<li>
<p>Se ejecuta como contenedor independiente, se conecta a HDFS (<code>hdfs://hadoop-namenode:9000</code>).</p>
</li>
<li>Procesa ficheros mediante Spark Streaming en modo batch y escribe logs en PostgreSQL mediante JDBC.</li>
<li>
<p><strong>HDFS (NameNode/DataNode)</strong></p>
</li>
<li>
<p>Almacena CSV en <code>/data/bank_accounts</code>.</p>
</li>
<li>Motor de validaciones lee ficheros desde aquí y borra tras procesar.</li>
</ul>
</li>
</ul>
<p><em>(Ver <code>docs/diagrama_arquitectura.png</code> para imagen detallada.)</em></p>
<hr />
<h3 id="42-tecnologias">4.2 Tecnologías<a class="headerlink" href="#42-tecnologias" title="Permanent link">&para;</a></h3>
<p>A continuación se especifican todas las tecnologías y dependencias utilizadas en cada componente:</p>
<h4 id="421-motor-de-validaciones-scala-spark">4.2.1 Motor de validaciones (Scala + Spark)<a class="headerlink" href="#421-motor-de-validaciones-scala-spark" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Scala 2.12</strong></li>
<li><strong>Apache Spark 3.x</strong></li>
<li><strong>HDFS (Hadoop 3.x)</strong></li>
<li><strong>SBT</strong> (build tool de Scala)</li>
<li><strong>Kryo</strong> (serialización para Spark)</li>
<li><strong>Docker</strong> (OpenJDK 11-slim, bitnami/spark)</li>
<li><strong>Docker Compose</strong> (orquestación)</li>
</ul>
<h4 id="422-backend-fastapi">4.2.2 Backend (FastAPI)<a class="headerlink" href="#422-backend-fastapi" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Python 3.12</strong></li>
<li><strong>FastAPI &gt;= 0.100.0</strong></li>
<li><strong>Uvicorn[standard] &gt;= 0.23.0</strong></li>
<li><strong>SQLAlchemy &gt;= 2.0 (Async)</strong></li>
<li><strong>asyncpg &gt;= 0.28</strong></li>
<li><strong>Pydantic Settings &gt;= 2.0</strong></li>
<li><strong>python-jose &gt;= 3.3</strong></li>
<li><strong>passlib[bcrypt] &gt;= 1.7</strong></li>
<li><strong>requests &gt;= 2.31</strong></li>
<li><strong>python-dotenv &gt;= 1.0</strong></li>
<li><strong>Docker</strong> (para ejecutar contenedores de backend en producción si se desea)</li>
</ul>
<h4 id="423-frontend-react">4.2.3 Frontend (React)<a class="headerlink" href="#423-frontend-react" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>React 18+</strong></li>
<li><strong>React Router v6</strong></li>
<li><strong>Axios</strong></li>
<li><strong>Context API</strong> (AuthContext)</li>
<li><strong>Vite</strong></li>
<li><strong>CSS puro</strong></li>
</ul>
<h4 id="424-base-de-datos-y-otros">4.2.4 Base de datos y otros<a class="headerlink" href="#424-base-de-datos-y-otros" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>PostgreSQL 13</strong></li>
<li><strong>Kafka (opcional)</strong></li>
<li><strong>Zookeeper (opcional)</strong></li>
<li><strong>Superset</strong> (opcional, para dashboards)</li>
<li><strong>PlantUML</strong> (diagramas de referencia)</li>
</ul>
<hr />
<h3 id="43-codigo-explicacion-de-las-partes-mas-interesantes">4.3 Código (Explicación de las partes más interesantes)<a class="headerlink" href="#43-codigo-explicacion-de-las-partes-mas-interesantes" title="Permanent link">&para;</a></h3>
<p>Se destacan las implementaciones clave de cada componente.</p>
<h4 id="431-motor-de-validaciones-scala">4.3.1 Motor de validaciones (Scala)<a class="headerlink" href="#431-motor-de-validaciones-scala" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p><strong><code>SparkSessionProvider.scala</code></strong></p>
<ul>
<li>Configura la <code>SparkSession</code> con parámetros personalizados:</li>
</ul>
<p><code>scala
  val spark = SparkSession.builder()
    .appName("ValidationEngine")
    .master("spark://spark-master:7077")
    .config("spark.serializer", "org.apache.spark.serializer.KryoSerializer")
    .config("spark.kryo.registrator", "com.mycompany.KryoRegistrator")
    .config("spark.hadoop.fs.defaultFS", "hdfs://hadoop-namenode:9000")
    .getOrCreate()</code>
* Ajusta particionamiento y directorios locales a través de <code>SPARK_LOCAL_DIRS</code>.</p>
</li>
<li>
<p><strong><code>ExecutionManager.scala</code></strong></p>
<ul>
<li>Orquesta todas las validaciones:</li>
</ul>
<p><code>scala
  def executeFile(path: String, outputTable: String): Unit = {
    val df = Reader.readFile(spark, path)
    if (!FileSentinel.verifyFiles(df, metadata)) {
      logTrigger(flag, metadata, path)
      return
    }
    if (!TypeValidator.verifyTyping(df, metadata)) {
      logTrigger(flag, metadata, path)
      return
    }
    if (!ReferentialIntegrityValidator.verifyIntegrity(df, metadata)) {
      logTrigger(flag, metadata, path)
      return
    }
    FunctionalValidator.verifyFunctional(df, metadata) match {
      case Some(error) =&gt; 
        logTrigger(errorFlag, metadata, path)
        return
      case None =&gt; 
        logTrigger(2, metadata, path)
    }
    // Registrar en PostgreSQL
    Writer.writeToJdbc(df, outputTable, dbConfig)
    // Borrar de HDFS
    spark.sparkContext.hadoopConfiguration
      .delete(new Path(path), false)
  }</code>
* <code>logTrigger(flag, metadata, path)</code>: escribe un DataFrame con columns (<code>logged_at</code>, <code>file_config_id</code>, <code>file_name</code>, <code>field_name</code>, <code>environment</code>, <code>validation_flag</code>, <code>error_message</code>) y hace <code>df.write.mode("append").jdbc(...)</code>.</p>
</li>
<li>
<p><strong>Multi-Stage Dockerfile (<code>docker/Dockerfile.engine</code>)</strong></p>
</li>
</ol>
<p>```dockerfile
   # Stage 1: Build con OpenJDK y SBT
   FROM openjdk:11-slim AS builder
   WORKDIR /app</p>
<p>RUN apt-get update &amp;&amp; apt-get install -y curl gnupg &amp;&amp; \
       echo "deb https://repo.scala-sbt.org/scalasbt/debian all main" &gt; /etc/apt/sources.list.d/sbt.list &amp;&amp; \
       curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&amp;search=0x99E82A75642AC823" | apt-key add - &amp;&amp; \
       apt-get update &amp;&amp; apt-get install -y sbt &amp;&amp; rm -rf /var/lib/apt/lists/*</p>
<p>COPY ../project   project/
   COPY ../build.sbt build.sbt
   COPY ../src       src/
   COPY ../db.properties db.properties
   COPY ../src/main/resources/application.conf src/main/resources/</p>
<p>RUN sbt clean assembly</p>
<p># Stage 2: Runtime Spark
   FROM bitnami/spark:3.3.1
   WORKDIR /app</p>
<p>COPY --from=builder /app/target/scala-2.12/Fin_de_Grado-assembly-0.1.0-SNAPSHOT.jar app.jar
   COPY ../db.properties    db.properties
   COPY ../src/main/resources/application.conf application.conf</p>
<p>ENV INPUT_DIR=/data/bank_accounts \
       OUTPUT_TABLE=trigger_control \
       POLL_INTERVAL_MS=10000 \
       SPARK_LOCAL_DIRS=/tmp/spark_local</p>
<p>ENTRYPOINT spark-submit \
     --class Main \
     --master spark://spark-master:7077 \
     --deploy-mode client \
     --conf spark.driver.host=validation-engine \
     --conf spark.hadoop.fs.defaultFS=hdfs://hadoop-namenode:9000 \
     /app/app.jar
   ```</p>
<pre><code>* **Stage 1:** instala SBT, compila fat JAR con todas las dependencias.
* **Stage 2:** parte de una imagen oficial de Spark; copia JAR, `db.properties` y `application.conf`; expone variables de entorno y lanza `spark-submit`.
</code></pre>
<ol>
<li><strong>Script de reconstrucción (<code>scripts/rebuild_and_run.sh</code>)</strong></li>
</ol>
<p>```bash
   #!/usr/bin/env bash
   set -euo pipefail</p>
<p># Construir el JAR con SBT
   sbt clean assembly</p>
<p># Crear red si no existe
   docker network create superset-net || true</p>
<p># Reconstruir y ejecutar solo el contenedor de validation-engine
   cd docker
   docker-compose build validation-engine
   docker-compose up --abort-on-container-exit validation-engine
   ```</p>
<pre><code>* Compila el JAR, crea la red `superset-net` y levanta únicamente el contenedor del motor de validaciones (asume que los demás servicios están corriendo).
</code></pre>
<hr />
<h4 id="432-backend-fastapi">4.3.2 Backend (FastAPI)<a class="headerlink" href="#432-backend-fastapi" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Configuración (<code>app/core/config.py</code>)</strong></li>
</ol>
<p>```python
   from pydantic import BaseSettings</p>
<p>class Settings(BaseSettings):
       postgres_user: str
       postgres_password: str
       postgres_host: str
       postgres_port: int
       postgres_db: str</p>
<pre><code>   hdfs_host: str
   hdfs_port: int
   hdfs_dir: str
   hdfs_user: str
   hdfs_datanode_host: str
   hdfs_datanode_port: int

   upload_dir: str
   jwt_secret_key: str
   jwt_algorithm: str
   access_token_expire_minutes: int

   class Config:
       env_file = ".env"
</code></pre>
<p>```</p>
<pre><code>* Carga variables desde `.env` y construye `database_url = f"postgresql+asyncpg://{user}:{password}@{host}:{port}/{db}"`.
</code></pre>
<ol>
<li><strong>Seguridad (<code>app/core/security.py</code>)</strong></li>
</ol>
<p>```python
   from jose import JWTError, jwt
   from passlib.context import CryptContext
   from fastapi import Depends, HTTPException, status
   from fastapi.security import OAuth2PasswordBearer
   from sqlalchemy.ext.asyncio import AsyncSession
   from .config import Settings
   from app.db.models.user import UserModel</p>
<p>pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
   oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/auth/login")</p>
<p>def verify_password(plain_password, hashed_password):
       return pwd_context.verify(plain_password, hashed_password)</p>
<p>def get_password_hash(password):
       return pwd_context.hash(password)</p>
<p>def create_access_token(subject: str, expires_delta=None):
       to_encode = {"sub": subject}
       # agregar expiración...
       encoded_jwt = jwt.encode(to_encode, Settings().jwt_secret_key, algorithm=Settings().jwt_algorithm)
       return encoded_jwt</p>
<p>async def get_current_user(token: str = Depends(oauth2_scheme), db: AsyncSession = Depends(get_db)):
       credentials_exception = HTTPException(
           status_code=status.HTTP_401_UNAUTHORIZED,
           detail="No autenticado",
           headers={"WWW-Authenticate": "Bearer"},
       )
       try:
           payload = jwt.decode(token, Settings().jwt_secret_key, algorithms=[Settings().jwt_algorithm])
           user_id: str = payload.get("sub")
           if user_id is None:
               raise credentials_exception
       except JWTError:
           raise credentials_exception
       user = await db.get(UserModel, int(user_id))
       if user is None:
           raise credentials_exception
       return user
   ```</p>
<pre><code>* Define hashing de contraseñas, creación de JWT, y dependencia `get_current_user` que valida el token y extrae `sub`.
</code></pre>
<ol>
<li><strong>Servicio de ficheros (<code>app/services/file_service.py</code>)</strong></li>
</ol>
<p>```python
   import os
   from sqlalchemy.ext.asyncio import AsyncSession
   from app.db.models.file_configuration import FileConfigurationModel</p>
<p>async def save_and_register_file(file, db: AsyncSession) -&gt; int:
       upload_dir = Settings().upload_dir
       os.makedirs(upload_dir, exist_ok=True)
       file_path = os.path.join(upload_dir, file.filename)
       with open(file_path, "wb") as f:
           content = await file.read()
           f.write(content)
       result = await db.execute(select(FileConfigurationModel).where(FileConfigurationModel.file_name == file.filename))
       existing = result.scalar_one_or_none()
       if existing:
           # actualizar parámetros si vienen en request
           existing.some_field = ...
           await db.commit()
           return existing.id
       else:
           new_cfg = FileConfigurationModel(
               file_format="csv",
               path=upload_dir,
               file_name=file.filename,
               has_header=True,
               delimiter=",",
               quote_char='"',
               escape_char="\",
               date_format="yyyy-MM-dd",
               timestamp_format="yyyy-MM-dd HH:mm:ss",
               partition_columns=None
           )
           db.add(new_cfg)
           await db.flush()
           return new_cfg.id
   ```</p>
<pre><code>* Guarda el CSV en disco local y crea/actualiza el registro en `file_configuration`.
</code></pre>
<ol>
<li><strong>Servicio HDFS (<code>app/services/hdfs_sync.py</code>)</strong></li>
</ol>
<p>```python
   import requests
   from fastapi import HTTPException
   from .config import Settings</p>
<p>def push_file_to_hdfs(file_name: str):
       settings = Settings()
       local_path = os.path.join(settings.upload_dir, file_name)
       if not os.path.exists(local_path):
           raise HTTPException(status_code=404, detail=f"Local not found: {local_path}")</p>
<pre><code>   # 1) MKDIRS
   mkdir_url = f"http://{settings.hdfs_host}:{settings.hdfs_port}/webhdfs/v1{settings.hdfs_dir}?op=MKDIRS&amp;user.name={settings.hdfs_user}"
   resp = requests.put(mkdir_url)
   resp.raise_for_status()

   # 2) SETPERM
   perm_url = f"http://{settings.hdfs_host}:{settings.hdfs_port}/webhdfs/v1{settings.hdfs_dir}?op=SETPERM&amp;permission=777&amp;user.name={settings.hdfs_user}"
   resp = requests.put(perm_url)
   resp.raise_for_status()

   # 3) CREATE (NameNode → 307 → Location → DataNode)
   create_url = f"http://{settings.hdfs_host}:{settings.hdfs_port}/webhdfs/v1{settings.hdfs_dir}/{file_name}?op=CREATE&amp;overwrite=true&amp;user.name={settings.hdfs_user}"
   resp = requests.put(create_url, allow_redirects=False)
   location = resp.headers.get("Location")
   if not location:
       raise HTTPException(status_code=500, detail="HDFS create failed: no redirect")
   # Ajustar URL al DataNode
   upload_url = location.replace(f"{settings.hdfs_host}:{settings.hdfs_port}", f"{settings.hdfs_datanode_host}:{settings.hdfs_datanode_port}")
   with open(local_path, "rb") as f:
       resp2 = requests.put(upload_url, data=f)
       resp2.raise_for_status()
</code></pre>
<p>```</p>
<pre><code>* Gestiona la secuencia WebHDFS (MKDIRS, SETPERM, CREATE → 307 → PUT a DataNode).
</code></pre>
<ol>
<li><strong>Rutas de archivos (<code>app/api/files.py</code>)</strong></li>
</ol>
<p>```python
   from fastapi import APIRouter, Depends, UploadFile, File, HTTPException
   from sqlalchemy.ext.asyncio import AsyncSession
   from app.services.file_service import save_and_register_file
   from app.services.hdfs_sync import push_file_to_hdfs
   from app.db.session import get_db</p>
<p>router = APIRouter(prefix="/files", tags=["files"])</p>
<p>@router.post("/upload", status_code=201)
   async def upload_file(file: UploadFile = File(...), db: AsyncSession = Depends(get_db)):
       try:
           file_id = await save_and_register_file(file, db)
           return {"file_config_id": file_id}
       except Exception as e:
           raise HTTPException(status_code=500, detail=str(e))</p>
<p>@router.post("/push/{file_name}")
   async def push_to_hdfs(file_name: str, user=Depends(get_current_user)):
       try:
           push_file_to_hdfs(file_name)
           return {"message": f"Pushed {file_name}"}
       except HTTPException as he:
           raise he
       except Exception as e:
           raise HTTPException(status_code=500, detail=str(e))</p>
<p>@router.get("/")
   async def list_configs(db: AsyncSession = Depends(get_db)):
       result = await db.execute(select(FileConfigurationModel))
       configs = result.scalars().all()
       return configs</p>
<p>@router.get("/{id}")
   async def get_config(id: int, db: AsyncSession = Depends(get_db)):
       cfg = await db.get(FileConfigurationModel, id)
       if not cfg:
           raise HTTPException(status_code=404, detail="Not found")
       return cfg</p>
<p>@router.patch("/{id}")
   async def update_config(id: int, payload: FileConfigUpdate, db: AsyncSession = Depends(get_db)):
       cfg = await db.get(FileConfigurationModel, id)
       if not cfg:
           raise HTTPException(status_code=404, detail="Not found")
       for key, val in payload.dict(exclude_unset=True).items():
           setattr(cfg, key, val)
       await db.commit()
       return cfg</p>
<p>@router.delete("/{id}", status_code=204)
   async def delete_config(id: int, db: AsyncSession = Depends(get_db)):
       cfg = await db.get(FileConfigurationModel, id)
       if not cfg:
           raise HTTPException(status_code=404, detail="Not found")
       await db.delete(cfg)
       await db.commit()</p>
<p>@router.get("/download/{file_name}")
   async def download_file(file_name: str):
       file_path = os.path.join(Settings().upload_dir, file_name)
       if not os.path.exists(file_path):
           raise HTTPException(status_code=404, detail="File not found")
       return FileResponse(file_path, media_type="text/csv", filename=file_name)</p>
<p>@router.get("/logs")
   async def get_logs(environment: str = None, from_date: date = None, to_date: date = None, db: AsyncSession = Depends(get_db)):
       query = select(TriggerControlModel)
       if environment:
           query = query.where(TriggerControlModel.environment == environment)
       if from_date:
           query = query.where(TriggerControlModel.logged_at &gt;= from_date)
       if to_date:
           query = query.where(TriggerControlModel.logged_at &lt;= to_date)
       result = await db.execute(query.order_by(TriggerControlModel.logged_at.desc()))
       logs = result.scalars().all()
       return logs
   ```</p>
<pre><code>* Endpoints para CRUD de configuraciones, subida, push a HDFS, descarga y consulta de logs.
</code></pre>
<hr />
<h4 id="433-frontend-react-vite">4.3.3 Frontend (React + Vite)<a class="headerlink" href="#433-frontend-react-vite" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Configuración de Axios (<code>src/api/axiosConfig.js</code>)</strong></li>
</ol>
<p>```js
   import axios from 'axios';</p>
<p>const api = axios.create({
     baseURL: 'http://localhost:8000',
   });</p>
<p>// Interceptor de petición: añade token si existe
   api.interceptors.request.use(config =&gt; {
     const token = localStorage.getItem('access_token');
     if (token) {
       config.headers.Authorization = <code>Bearer ${token}</code>;
     }
     return config;
   });</p>
<p>// Interceptor de respuesta: si 401, borrar token y redirigir
   api.interceptors.response.use(
     response =&gt; response,
     error =&gt; {
       if (error.response &amp;&amp; error.response.status === 401) {
         localStorage.removeItem('access_token');
         alert('Tu sesión ha expirado. Por favor, inicia sesión de nuevo.');
         window.location.href = '/login';
       }
       return Promise.reject(error);
     }
   );</p>
<p>export default api;
   ```</p>
<pre><code>* Gestiona token en cada petición y maneja 401 automáticamente.
</code></pre>
<ol>
<li><strong><code>AuthContext.jsx</code></strong></li>
</ol>
<p>```jsx
   import React, { createContext, useState, useEffect } from 'react';
   import { useNavigate } from 'react-router-dom';
   import api from '../api/axiosConfig';</p>
<p>export const AuthContext = createContext();</p>
<p>export const AuthProvider = ({ children }) =&gt; {
     const [token, setToken] = useState(localStorage.getItem('access_token'));
     const navigate = useNavigate();</p>
<pre><code> useEffect(() =&gt; {
   if (token) {
     localStorage.setItem('access_token', token);
   } else {
     localStorage.removeItem('access_token');
   }
 }, [token]);

 const login = async (email, password) =&gt; {
   const res = await api.post('/auth/login', { email, password });
   setToken(res.data.access_token);
   navigate('/dashboard');
 };

 const register = async (email, password) =&gt; {
   await api.post('/auth/register', { email, password });
   navigate('/login');
 };

 const logout = () =&gt; {
   setToken(null);
   navigate('/login');
 };

 return (
   &lt;AuthContext.Provider value={{ token, login, register, logout }}&gt;
     {children}
   &lt;/AuthContext.Provider&gt;
 );
</code></pre>
<p>};
   ```</p>
<pre><code>* Gestiona estado global de autenticación y métodos `login()`, `register()`, `logout()`.
</code></pre>
<ol>
<li><strong><code>AppRouter.jsx</code></strong></li>
</ol>
<p>```jsx
   import React, { useContext } from 'react';
   import { BrowserRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom';
   import { AuthContext } from '../contexts/AuthContext';
   import LoginPage from '../pages/LoginPage';
   import RegisterPage from '../pages/RegisterPage';
   import Dashboard from '../pages/Dashboard';
   import LogsPage from '../pages/LogsPage';
   import MainLayout from '../layouts/MainLayout';</p>
<p>const RequireAuth = ({ children }) =&gt; {
     const { token } = useContext(AuthContext);
     const location = useLocation();
     return token ? children : <Navigate to="/login" state={{ from: location }} replace />;
   };</p>
<p>const AppRouter = () =&gt; (
     <BrowserRouter>
       <Routes>
         <Route path="/login" element={\<LoginPage />} />
         <Route path="/register" element={\<RegisterPage />} />
         <Route path="/" element={\<RequireAuth>\<MainLayout />\</RequireAuth>}>
           <Route index element={\<Navigate to="/dashboard" replace />} />
           <Route path="dashboard" element={\<Dashboard />} />
           <Route path="logs" element={\<LogsPage />} />
         </Route>
         <Route path="*" element={\<Navigate to="/login" replace />} />
       </Routes>
     </BrowserRouter>
   );</p>
<p>export default AppRouter;
   ```</p>
<pre><code>* Define rutas públicas (`/login`, `/register`) y privadas (`/dashboard`, `/logs`) con `RequireAuth`.
</code></pre>
<ol>
<li><strong><code>Dashboard.jsx</code></strong></li>
</ol>
<p>```jsx
   import React, { useState, useEffect, useContext } from 'react';
   import { AuthContext } from '../contexts/AuthContext';
   import api from '../api/axiosConfig';
   import FileDetailModal from '../components/FileDetailModal';</p>
<p>const Dashboard = () =&gt; {
     const [configs, setConfigs] = useState([]);
     const [selectedFile, setSelectedFile] = useState(null);
     const [uploading, setUploading] = useState(false);
     const [showModal, setShowModal] = useState(false);
     const [currentConfig, setCurrentConfig] = useState(null);</p>
<pre><code> const fetchConfigs = async () =&gt; {
   const res = await api.get('/files/');
   setConfigs(res.data);
 };

 useEffect(() =&gt; {
   fetchConfigs();
 }, []);

 const handleUpload = async () =&gt; {
   if (!selectedFile) return;
   setUploading(true);
   const form = new FormData();
   form.append('file', selectedFile);
   const res = await api.post('/files/upload', form);
   alert(`Fichero subido ID: ${res.data.file_config_id}`);
   fetchConfigs();
   setUploading(false);
 };

 const handleValidate = async (fileName) =&gt; {
   await api.post(`/files/push/${fileName}`);
   alert('Enviado a validar');
   fetchConfigs();
 };

 const handleDelete = async (id) =&gt; {
   if (!window.confirm('¿Estás seguro?')) return;
   await api.delete(`/files/${id}`);
   alert('Configuración eliminada');
   fetchConfigs();
 };

 return (
   &lt;div&gt;
     &lt;h2&gt;Dashboard&lt;/h2&gt;
     &lt;input type="file" onChange={e =&gt; setSelectedFile(e.target.files[0])} /&gt;
     &lt;button onClick={handleUpload} disabled={uploading}&gt;
       {uploading ? 'Subiendo...' : 'Subir Fichero'}
     &lt;/button&gt;
     &lt;table&gt;
       &lt;thead&gt;
         &lt;tr&gt;
           &lt;th&gt;ID&lt;/th&gt;
           &lt;th&gt;Fichero&lt;/th&gt;
           &lt;th&gt;Has Header&lt;/th&gt;
           &lt;th&gt;Delimiter&lt;/th&gt;
           &lt;th&gt;Acciones&lt;/th&gt;
         &lt;/tr&gt;
       &lt;/thead&gt;
       &lt;tbody&gt;
         {configs.map(cfg =&gt; (
           &lt;tr key={cfg.id}&gt;
             &lt;td&gt;{cfg.id}&lt;/td&gt;
             &lt;td&gt;{cfg.file_name}&lt;/td&gt;
             &lt;td&gt;{cfg.has_header ? 'Sí' : 'No'}&lt;/td&gt;
             &lt;td&gt;{cfg.delimiter}&lt;/td&gt;
             &lt;td&gt;
               &lt;button onClick={() =&gt; handleValidate(cfg.file_name)}&gt;Enviando…&lt;/button&gt;
               &lt;button onClick={() =&gt; { setCurrentConfig(cfg); setShowModal(true); }}&gt;Detalles&lt;/button&gt;
               &lt;button onClick={() =&gt; handleDelete(cfg.id)}&gt;Eliminar&lt;/button&gt;
             &lt;/td&gt;
           &lt;/tr&gt;
         ))}
       &lt;/tbody&gt;
     &lt;/table&gt;
     {showModal &amp;&amp; (
       &lt;FileDetailModal
         config={currentConfig}
         onClose={() =&gt; setShowModal(false)}
         onRefresh={fetchConfigs}
       /&gt;
     )}
   &lt;/div&gt;
 );
</code></pre>
<p>};</p>
<p>export default Dashboard;
   ```</p>
<pre><code>* Subida de fichero, lista de configuraciones con acciones (Validar, Detalles, Eliminar).
</code></pre>
<ol>
<li><strong><code>FileDetailModal.jsx</code></strong></li>
</ol>
<p>```jsx
   import React, { useState } from 'react';
   import api from '../api/axiosConfig';</p>
<p>const FileDetailModal = ({ config, onClose, onRefresh }) =&gt; {
     const [delimiter, setDelimiter] = useState(config.delimiter);
     const [quoteChar, setQuoteChar] = useState(config.quote_char);
     const [escapeChar, setEscapeChar] = useState(config.escape_char);
     const [hasHeader, setHasHeader] = useState(config.has_header);
     const [dateFormat, setDateFormat] = useState(config.date_format);
     const [timestampFormat, setTimestampFormat] = useState(config.timestamp_format);
     const [partitionColumns, setPartitionColumns] = useState(config.partition_columns);
     const [saving, setSaving] = useState(false);
     const [validating, setValidating] = useState(false);
     const [deleting, setDeleting] = useState(false);</p>
<pre><code> const save = async () =&gt; {
   setSaving(true);
   await api.patch(`/files/${config.id}`, {
     delimiter, quote_char: quoteChar, escape_char: escapeChar,
     has_header: hasHeader, date_format: dateFormat,
     timestamp_format: timestampFormat, partition_columns: partitionColumns
   });
   alert('Configuración actualizada');
   setSaving(false);
   onClose();
   onRefresh();
 };

 const validate = async () =&gt; {
   setValidating(true);
   await api.post(`/files/push/${config.file_name}`);
   alert('Enviado a validar');
   setValidating(false);
   onClose();
   onRefresh();
 };

 const downloadFile = async () =&gt; {
   const res = await fetch(`http://localhost:8000/files/download/${config.file_name}`, {
     headers: { Authorization: `Bearer ${localStorage.getItem('access_token')}` }
   });
   const blob = await res.blob();
   const url = URL.createObjectURL(blob);
   const a = document.createElement('a');
   a.href = url;
   a.download = config.file_name;
   a.click();
   URL.revokeObjectURL(url);
 };

 const remove = async () =&gt; {
   if (!window.confirm('¿Estás seguro?')) return;
   setDeleting(true);
   await api.delete(`/files/${config.id}`);
   alert('Configuración eliminada');
   setDeleting(false);
   onClose();
   onRefresh();
 };

 const overlayStyle = {
   position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
   backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex',
   justifyContent: 'center', alignItems: 'center'
 };
 const modalStyle = {
   background: '#fff', padding: '1rem', borderRadius: '8px',
   position: 'relative', width: '500px'
 };

 return (
   &lt;div style={overlayStyle} onClick={onClose}&gt;
     &lt;div style={modalStyle} onClick={e =&gt; e.stopPropagation()}&gt;
       &lt;h3&gt;Detalles Fichero&lt;/h3&gt;
       &lt;label&gt;Delimiter:&lt;/label&gt;
       &lt;select value={delimiter} onChange={e =&gt; setDelimiter(e.target.value)}&gt;
         &lt;option value=","&gt;Comma&lt;/option&gt;
         &lt;option value=";"&gt;Semicolon&lt;/option&gt;
         &lt;option value="\t"&gt;Tab&lt;/option&gt;
         &lt;option value="|"&gt;Pipe&lt;/option&gt;
       &lt;/select&gt;
       &lt;label&gt;Quote Character:&lt;/label&gt;
       &lt;select value={quoteChar} onChange={e =&gt; setQuoteChar(e.target.value)}&gt;
         &lt;option value={'"'}&gt;Double&lt;/option&gt;
         &lt;option value="'"&gt;Single&lt;/option&gt;
         &lt;option value=""&gt;None&lt;/option&gt;
       &lt;/select&gt;
       &lt;label&gt;Escape Character:&lt;/label&gt;
       &lt;select value={escapeChar} onChange={e =&gt; setEscapeChar(e.target.value)}&gt;
         &lt;option value="\\"&gt;Backslash&lt;/option&gt;
         &lt;option value={'"'}&gt;Double&lt;/option&gt;
         &lt;option value=""&gt;None&lt;/option&gt;
       &lt;/select&gt;
       &lt;label&gt;Has Header:&lt;/label&gt;
       &lt;input type="checkbox" checked={hasHeader} onChange={e =&gt; setHasHeader(e.target.checked)} /&gt;
       &lt;label&gt;Date Format:&lt;/label&gt;
       &lt;select value={dateFormat} onChange={e =&gt; setDateFormat(e.target.value)}&gt;
         &lt;option value="yyyy-MM-dd"&gt;YYYY-MM-DD&lt;/option&gt;
         &lt;option value="dd/MM/yyyy"&gt;DD/MM/YYYY&lt;/option&gt;
         &lt;option value="MM-dd-yyyy"&gt;MM-DD-YYYY&lt;/option&gt;
       &lt;/select&gt;
       &lt;label&gt;Timestamp Format:&lt;/label&gt;
       &lt;select value={timestampFormat} onChange={e =&gt; setTimestampFormat(e.target.value)}&gt;
         &lt;option value="yyyy-MM-dd HH:mm:ss"&gt;YYYY-MM-DD HH:mm:ss&lt;/option&gt;
         &lt;option value="ISO 8601"&gt;ISO 8601&lt;/option&gt;
         &lt;option value="Timestamp MS"&gt;Timestamp MS&lt;/option&gt;
       &lt;/select&gt;
       &lt;label&gt;Partition Columns:&lt;/label&gt;
       &lt;input
         type="text"
         value={partitionColumns || ''}
         onChange={e =&gt; setPartitionColumns(e.target.value)}
       /&gt;
       &lt;div style={{ marginTop: '1rem' }}&gt;
         &lt;button onClick={save} disabled={saving}&gt;
           {saving ? 'Guardando...' : 'Guardar'}
         &lt;/button&gt;
         &lt;button onClick={validate} disabled={validating}&gt;
           {validating ? 'Enviando…' : 'Validar'}
         &lt;/button&gt;
         &lt;button onClick={downloadFile}&gt;Descargar&lt;/button&gt;
         &lt;button onClick={remove} disabled={deleting}&gt;
           {deleting ? 'Eliminando…' : 'Eliminar'}
         &lt;/button&gt;
       &lt;/div&gt;
       &lt;button onClick={onClose} style={{ position: 'absolute', top: '8px', right: '8px' }}&gt;×&lt;/button&gt;
     &lt;/div&gt;
   &lt;/div&gt;
 );
</code></pre>
<p>};</p>
<p>export default FileDetailModal;
   ```</p>
<pre><code>* Modal para editar parámetros, validar, descargar y eliminar configuración.
</code></pre>
<ol>
<li><strong><code>LogsPage.jsx</code></strong></li>
</ol>
<p>```jsx
   import React, { useState, useEffect } from 'react';
   import api from '../api/axiosConfig';</p>
<p>const LogsPage = () =&gt; {
     const [logs, setLogs] = useState([]);</p>
<pre><code> const fetchLogs = async () =&gt; {
   const res = await api.get('/files/logs');
   setLogs(res.data);
 };

 useEffect(() =&gt; {
   fetchLogs();
 }, []);

 return (
   &lt;div&gt;
     &lt;h2&gt;Logs de Validación&lt;/h2&gt;
     &lt;table&gt;
       &lt;thead&gt;
         &lt;tr&gt;
           &lt;th&gt;ID&lt;/th&gt;
           &lt;th&gt;Config ID&lt;/th&gt;
           &lt;th&gt;Fichero&lt;/th&gt;
           &lt;th&gt;Campo&lt;/th&gt;
           &lt;th&gt;Entorno&lt;/th&gt;
           &lt;th&gt;Flag&lt;/th&gt;
           &lt;th&gt;Mensaje&lt;/th&gt;
           &lt;th&gt;Fecha&lt;/th&gt;
         &lt;/tr&gt;
       &lt;/thead&gt;
       &lt;tbody&gt;
         {logs.map(l =&gt; (
           &lt;tr key={l.id}&gt;
             &lt;td&gt;{l.id}&lt;/td&gt;
             &lt;td&gt;{l.file_config_id}&lt;/td&gt;
             &lt;td&gt;{l.file_name}&lt;/td&gt;
             &lt;td&gt;{l.field_name}&lt;/td&gt;
             &lt;td&gt;{l.environment}&lt;/td&gt;
             &lt;td&gt;{l.validation_flag}&lt;/td&gt;
             &lt;td&gt;{l.error_message}&lt;/td&gt;
             &lt;td&gt;{new Date(l.logged_at).toLocaleDateString('es-ES')}&lt;/td&gt;
           &lt;/tr&gt;
         ))}
       &lt;/tbody&gt;
     &lt;/table&gt;
   &lt;/div&gt;
 );
</code></pre>
<p>};</p>
<p>export default LogsPage;
   ```</p>
<pre><code>* Muestra los logs de validación y formatea la fecha a español.
</code></pre>
<hr />
<h3 id="44-organizacion-del-proyecto-patron">4.4 Organización del proyecto. Patrón<a class="headerlink" href="#44-organizacion-del-proyecto-patron" title="Permanent link">&para;</a></h3>
<p>Se propone la siguiente estructura monolítica (tres carpetas principales), aunque cada componente puede colocarse en repositorios separados según conveniencia:</p>
<pre><code>FileMonitoringSystem/
├── backend/                            ← Código FastAPI
│   ├── app/
│   │   ├── api/
│   │   │   ├── auth.py
│   │   │   ├── files.py
│   │   │   └── health.py
│   │   ├── core/
│   │   │   ├── config.py
│   │   │   └── security.py
│   │   ├── db/
│   │   │   ├── base.py
│   │   │   ├── session.py
│   │   │   └── models/
│   │   │       ├── user.py
│   │   │       ├── file_configuration.py
│   │   │       ├── semantic_layer.py      ← metadatos de campos
│   │   │       ├── trigger_control.py
│   │   │       └── negative_flag_logs.py
│   │   ├── services/
│   │   │   ├── file_service.py
│   │   │   └── hdfs_sync.py
│   │   └── schemas/
│   │       ├── auth.py
│   │       ├── files.py
│   │       └── logs.py
│   ├── main.py
│   ├── .env
│   ├── requirements.txt
│   └── test_api.sh
│
├── frontend/                           ← Código React + Vite
│   ├── public/
│   │   └── index.html
│   ├── src/
│   │   ├── api/
│   │   │   └── axiosConfig.js
│   │   ├── components/
│   │   │   └── FileDetailModal.jsx
│   │   ├── contexts/
│   │   │   └── AuthContext.jsx
│   │   ├── layouts/
│   │   │   └── MainLayout.jsx
│   │   ├── pages/
│   │   │   ├── Dashboard.jsx
│   │   │   ├── LoginPage.jsx
│   │   │   ├── RegisterPage.jsx
│   │   │   └── LogsPage.jsx
│   │   ├── routes/
│   │   │   └── AppRouter.jsx
│   │   ├── styles/
│   │   │   └── index.css
│   │   └── main.jsx
│   ├── package.json
│   └── README.md
│
├── engine/                             ← Motor de validaciones Scala + Spark
│   ├── docker/
│   │   ├── Dockerfile.engine
│   │   ├── Dockerfile.superset
│   │   └── docker-compose.yml
│   ├── docs/                           ← Diagramas PNG
│   │   ├── diagrama_casos_de_uso.png
│   │   ├── ERD.png
│   │   ├── diagrama_clases.png
│   │   ├── diagrama_secuencia.png
│   │   └── ...
│   ├── scripts/
│   │   └── rebuild_and_run.sh
│   ├── src/
│   │   ├── main/
│   │   │   ├── resources/
│   │   │   │   ├── application.conf
│   │   │   │   ├── db.properties
│   │   │   │   └── files/                ← Scripts Python para generar CSV de prueba
│   │   │   └── scala/
│   │   │       ├── Main.scala
│   │   │       ├── config/
│   │   │       │   ├── DbConfig.scala
│   │   │       │   ├── DBConnection.scala
│   │   │       │   └── SparkSessionProvider.scala
│   │   │       ├── models/
│   │   │       │   ├── FileConfigurationCaseClass.scala
│   │   │       │   └── SemanticLayerCaseClass.scala
│   │   │       ├── services/
│   │   │       │   ├── ExecutionManager.scala
│   │   │       │   └── TriggerIdManager.scala
│   │   │       ├── utils/
│   │   │       │   ├── Reader.scala
│   │   │       │   ├── Writer.scala
│   │   │       │   └── FileManager.scala
│   │   │       └── validators/
│   │   │           ├── FileSentinel.scala
│   │   │           ├── TypeValidator.scala
│   │   │           ├── ReferentialIntegrityValidator.scala
│   │   │           └── FunctionalValidator.scala
│   │   ├── test/scala/                 ← Pruebas unitarias (ScalaTest)
│   │   └── build.sbt
│   └── README-cluster.md               ← Guía de cluster Hadoop/Spark/Kafka/Superset
│
├── docs/                               ← Carpeta MkDocs (documentación “libro”)
│   ├── 01-introduccion.md
│   ├── 02-requisitos.md
│   ├── 03-diseno.md
│   ├── 04-implementacion.md
│   ├── 05-resultado.md
│   ├── 06-conclusiones.md
│   └── img/
│       ├── diagrama_casos_de_uso.png
│       ├── ERD.png
│       ├── diagrama_clases.png
│       ├── diagrama_secuencia.png
│       └── ... (otros PNG)
│
├── mkdocs.yml                          ← Configuración de MkDocs
├── .github/
│   └── workflows/
│       └── mkdocs-deploy.yml           ← GitHub Action para desplegar en Pages
│
└── README-cluster.md                   ← Guía de cluster (si quieres)  
</code></pre>
<ul>
<li>El patrón es <strong>feature-based</strong>: cada carpeta agrupa archivos según responsabilidad (API, servicios, modelos, diagramas, etc.).</li>
<li>Cada componente puede versionarse por separado y luego combinarse en un monorepo si se desea.</li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>